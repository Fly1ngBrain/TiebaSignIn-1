name: Daily Tieba Sign-In

on:
  workflow_dispatch:
  schedule:
    - cron: '30 22 * * *'  # åŒ—äº¬æ—¶é—´ 6:30 (UTC+8)

jobs:
  signin:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '8'
          cache: 'maven'  # ä½¿ç”¨å®˜æ–¹æ¨èçš„ Maven ä¾èµ–ç¼“å­˜

      - name: Build and execute
        env:
          BDUSS: ${{ secrets.BDUSS }}
          SCKEY: ${{ secrets.SCKEY }}
        run: |
          mvn -B compile exec:java \
            -Dexec.mainClass="top.srcrs.Run" \
            -Dexec.args="$BDUSS $SCKEY"

      - name: ğŸš— Keep Running
        if: github.event_name == 'schedule'
        run: |
          git config --local user.email "${{ github.actor_id }}+${{ github.actor }}@users.noreply.github.com"
          git config --local user.name "${{ github.actor }}"
          git remote set-url origin https://${{ github.actor }}:${{ github.token }}@github.com/${{ github.repository }}
          git pull --rebase --autostash
          git commit --allow-empty -m "Keep Running..."
          git push

      - name: ğŸ‰ Delete old workflow run
        uses: Mattraks/delete-workflow-runs@main
        with:
          token: ${{ github.token }}
          repository: ${{ github.repository }}
          retain_days: 0
          keep_minimum_runs: 50
